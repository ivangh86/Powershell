$Server = "localhost"$c=0$p=0$s=0$d=0IF (Test-Connection -quiet -ComputerName $Server -Count 1){ $ESini = "\E$\ProgramData\Citrix\System Monitoring\Data\EdgeSight.ini"$ESdb = "\E$\ProgramData\Citrix\System Monitoring\Data\RSDATR.FDB"$ServerESini = "\\" + $Server + $ESini$ServerESdb = "\\" + $Server + $ESdb$service = "RSCorSVC"if (Test-Path $ServerESini){Write-Host $Server has Edgesightsc.exe \\$Server STOP $servicedo { Start-Sleep -Milliseconds 400}until ((get-service -ComputerName $Server $service).status -eq 'Stopped')write-host "Servicio parado"taskkill /s $Server /im rscorsvc.exe /fwrite-host "Modificamos Fichero INI"(Get-Content $ServerESini) | ForEach-Object { $_ -replace "InitialFuncMode=1" , "InitialFuncMode=2" } | Set-Content $ServerESiniwrite-host "Eliminamos BBDD"del -Path $ServerESdb -Forcesc.exe \\$server START $servicedo { Start-Sleep -Milliseconds 400}until ((get-service -ComputerName $Server $service).status -eq 'Running')write-host "Servicio arrancado"  $p++} else{Write-Host $Server does NOT have Edgesight $s++}  }else{write-host $Server "down (or Firewall Enabled)" -BackgroundColor Red$d++}$c++  Write-Host $d Down "(or Firewall Enabled)"Write-Host $c TotalWrite-Host $p EdgesightWrite-Host $s No Edgesight